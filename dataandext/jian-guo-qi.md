# 键过期功能

让Redis在指定的时间自动删除特定的键 .

#### 键盘过期功能的相关命令

* 设置生存时间 - EXPIRE命令和PEXPIRE命令
* 设置过期时间 - EXPIREAT命令和PEXPIREAT命令
* 查看剩余生存时间 - TTL命令和PTTL命令
* 删除生存时间或过期时间 - PERSIST命令

#### 设置生存时间

```
EXPIRE key seconds # 将键 key 的生存时间设置为指定的秒数,复杂度O(1)
PEXPIRE key milliseconds # 将键 key 的生存时间设置为指定的毫秒数,复杂度O(1)
```

如果给定的键不存在,那么EXPIRE和PEXPIRE将返回0,表示设置失败;如果命令返回1,那么表 示设置成功 .

当一个键的生存时间被减少至低于0时,Redis就会自动将这个键删除掉 .

> 严格来说 , 设置生存时间为5,会让键存在6秒钟 .
>
> Redis默认每100毫秒检查一次键是否过期 .

#### 设置过期时间

```
EXPIREAT key timestamp # 将键 key 的过期时间设置为指定 的秒级 UNIX 时间戳,复杂度O(1)
PEXPIREAT key milliseconds-timestamp # 将键 key 的过期时间设置为指定 的毫秒级 UNIX 时间戳,复杂度O(1)
```

如果给定的键不存在,那么EXPIREAT和PEXPIREAT将返回0,表示设置失败;如果命令返回1, 那么表示设置成功 .

对于被设置了过期时间的键来说,当键的过期时间小于当前时间的时候,Redis就会自动地删除该键 .

#### 生存时间和过期时间的区别

设置生存时间和设置过期时间都可以让Redis自动删除指定的键,它们的区别在于设置“键什么时候要被删除”的方式不同 :

* EXPIRE和PEXIRE的作用是让键在N秒钟或者N毫秒之后被删除

* 而EXPIREAT和PEXPIREAT的作用则是让键在指定的UNIX时间到达之后被删除

带有生存时间的键就像是一个倒计时器,它会倒数5、4、3、2、1、0,然后被删掉 .

而带有过期时间的键则像是一个定时器 , 它会在指定的时间来临之后被删掉 .

#### 返回键的剩余生存时间

在为一个键设置过期时间或者生存时间之后,用户可以使用TTL命令或者PTTL命令查看这个键的剩余生存时间,以此来获知键还有多久才会被Redis删除 :

```
TTL key # 以秒为单位,返回键的剩余生存时间,复杂度O(1)
PTTL key # 以毫秒为单位,返回键的剩余生存时间,复杂度O(1)
```

**返回值**

* -2 : 键不存在
* -1 : 键存在,但没有设置过期时间或者生存时间
* &gt;= 0 : 键的剩余生存时间

> **注意**
>
> Redis并没有提供查看键的过期时间的命令,所以对于一个设置了过期时间的键来说,我们只能使用TTL和PTTL来查看它的剩余生存时间 .

#### 移除键的过期时间或生存时间

```
PERSIST key
```

移除为键key设置的过期时间或生存时间,使得它不会被Redis自动删除 .

移除成功时命令返回1;如果命令没有设置过期时间或生存时间,那么命令返回0 .

复杂度为O\(1\)

---

#### 命令更新

Redis在2.0版本新增了SETEX命令

```
SETEX key seconds value
```

Redis 2.6.0版本开始支持毫秒精度的过期时间和生存时间

```
PSETEX key milliseconds value
```

还有前面提到的PEXPIRE、PEXPIREAT、PTTL

在Redis 2.6.12版本,Redis又对SET命令进行了修改 , 支持可选的EX参数和PX参数 : 

```
SET key value [EX seconds] [PX milliseconds]
```



