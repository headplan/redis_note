# 有序集合

按照元素的分值来有序的存储各不相同的元素 .

有序集合和集合一样 , 都可以包含任意数量的 , 各不相同的元素 . 不同于集合的是, 有序集合的每个元素都有关联着一个浮点格式的分值 , 并且有序集合会按照分值 , 以从小到大的顺序来排列有序集合的各个元素 .

##### **一个保存了水果价格的有序集合:**

##### ![](/assets/zset-1.png)

### 基本操作

**添加元素**

```
ZADD key score element [[score element] [score element] ...]
```

按照给定的分值和元素 , 将任意数量的元素添加到有序集合里面 , 命令的返回值为成功添加的元素数量 .

复杂度O\(M\*log\(N\)\) , 其中N为有序集合已有的元素数量 , M为成功添加的新元素数量 .

**删除元素**

```
ZREM key element [element ...]
```

从有序集合中删除指定的元素 , 以及这些元素关联的分值 , 命令返回被成功删除的元素数量 .

复杂度O\(M\*log\(N\)\) , 其中N为有序集合已有的元素数量 , M为成功删除的元素数量 .

**返回元素的分值**

```
ZSCORE key element
```

返回有序集合中 , 指定元素的分值 .

复杂度为O\(1\) .

**增加或减少元素的分值**

```
ZINCRBY key increment element
```

为有序集合指定元素的分值加上增量increment , 命令返回执行操作之后,元素的分值 .

没有相应的ZDECRBY命令 , 但可以通过将increment设置为负数来减少分值 .

复杂度为O\(log\(N\)\) .

**返回有序集合的基数**

```
ZCARD key
```

返回有序集合包含的元素数量\(基数\)

复杂度为O\(1\)

**返回元素的排名**

```
ZRANK key element
```

返回指定元素在有序集合中的排名,其中排名按照元素的分值从小到大计算 . 排名以0开始 .

复杂度为O\(log\(N\)\) .

**返回元素的逆序排名**

```
ZREVRANK key member
```

返回成员在有序集合中的逆序排名,其中排名按照元素的分值从大到小计算 . 排名以0开始 .

复杂度为O\(log\(N\)\)

---

### 分值范围操作

**获取指定索引范围内的升序元素**

```
ZRANGE key start stop [WITHSCORES]
```

返回有序集合在按照分值从小到大排列元素\(升序排列\)的情况下 , 索引start至索引stop范围之内的所有元素 .

两个索引都可以是正数或者负数 . 当给定WITHSCORES选项时 , 命令会将元素和分值一并返回 .

命令的复杂度为O\(log\(N\)+M\) , N为有序集合的基数 , 而M则为被返回元素的数量 .

**获取指定索引范围内的降序元素**

```
ZREVRANGE key start stop [WITHSCORES]
```

返回有序集合在按照分值从大到小排列元素\(降序排列\)的情况下 , 索引start至索引stop范围之内的所有元素 .  
 两个索引都可以是正数或者负数 . 当给定WITHSCORES选项时 , 命令会把元素和分值一并返回 .

命令的复杂度为O\(log\(N\)+M\),N为有序集合的基数,而M则为被返回元素的数量 .

**获取指定分值范围内的升序元素**

```
ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]
```

返回有序集合在按照分值升序排列元素的情况下,分值在min和max范围之内的所有元素 .

给定WITHSCORES选项时,元素和分值会一并返回。给定LIMIT选项时,可以通过offset参数指定返回的结果集要跳过多少个元素,而count参数则用于指定返回的元素数量 .

命令的复杂度为O\(log\(N\)+M\),N为有序集合的基数,而M则为被返回元素的数量 .

**获取指定分值范围内的降序元素**

```
ZREVRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]
```

返回有序集合在按照分值降序排列元素的情况下,分值在min和max范围之内的所有元素 .

给定WITHSCORES选项时,元素和分值会一并返回。给定LIMIT选项,可以通过offset参数指定返回 的结果集要跳过多少个元素,而count参数则用于指定返回的元素数量 .

命令的复杂度为O\(log\(N\)+M\),N为有序集合的基数,而M则为被返回元素的数量 .

**计算给定分值范围内的元素数量**

```
ZCOUNT key min max
```

返回有序集合在升序排列元素的情况下 , 分值在min和max范围内的元素数量 .

复杂度为O\(log\(N\)\) , N为有序集合的基数 .

**移除指定排名范围内的升序排列元素**

```
ZREMRANGEBYRANK key start stop
```

移除有序集合中,元素按升序进行排列的情况下,指定排名范围内的所有元素 .

排名范围可以使用正数和负数 .

令的复杂度为O\(log\(N\)+M\),N为有序集合的基数,而M则为被移除元素的数量 .

**移除指定分值范围内的升序排列元素**

```
ZREMRANGEBYSCORE key min max
```

移除有序集合中,分值范围介于min和max之内的所有元素 .

命令的复杂度为O\(log\(N\)+M\), 其中N为有序集合的基数,  
 而M为被移除元素的数量 .

### 集合运算操作

**计算并集和交集**

| 命令 | 作用 | 复杂度 |
| :--- | :--- | :--- |
| ZUNIONSTORE destkey numkeys key \[key ...\] | 计算并集 | O\(N\)+O\(M log\(M\)\),N为参与并集计算的元素数量,M为结果集的基数。 |
| ZINTERSTORE destkey numkeys key \[key ...\] | 计算交集 | O\(N\*K\)+O\(M\*log\(M\)\),N为给定有序 集合中,基数最小的有序集合的基 数,K为给定有序集合的数量,M为 结果集的基数。 |

计算结果会被储存到destkey里面,命令返回结果集的基数 . 

numkeys参数指定要进行计算的有序集合个数,key \[key ...\]指定进行计算的各个有序集合 . 

