# 复制和Sentinel

扩展系统处理读请求的能力 , 并提高系统的可用性 .

### 复制

创建具有相同数据库的拷贝服务器 .

Redis的复制\(replication\)功能允许用户根据一个Redis服务器来创建任意多个该服务器的复制品 , 其中被复制的服务器为主服务器\(master\) , 而通过复制创建出来的服务器复制品则为从服务器\(slave\) . 主从服务器两者拥有相同的数据库数据 , 只要主从服务器之间的网络连接正常 , 主服务器就会一直将发生在自己身上的数据更新同步给从服务器 , 从而一直保证主从服务器的数据相同 .

![](/assets/fuzhi.png)

图中展示了一个拥有一个 从服务器的主服务器 , 和一个拥有三个从服务器的主服务器 ,

#### 使用从服务器来处理读命令请求

Redis允许从服务器执行客户端发送的读命令 , 比如GET、LRANGE、SMEMBERS、HGET、

ZRANGE等等 .

因为主从服务器拥有相同的数据库数据 , 所以从服务器在执行客户端发送的读命令时 , 获得的结果与主服务器执行相同的读命令所获得的结果是一样的 . 因此 , 用户可以将原本由主服务器负责处理的一部分\(甚至全部\)读命令请求转交给从服务器处理 , 从而降低主服务器在处理读命令请求方面的负载 , 并扩展整个系统处理读命令请求的能力 .

![](/assets/fuzhi2.png)

#### 通过复制来扩展系统处理读请求的能力

通过添加从服务器可以线性的扩展整个系统处理读命令请求的能力 .

| 服务器配置 | 每秒钟能够处理的读命令请求数量 |
| :--- | :--- |
| 一台主服务器 | N |
| 一台主服务器+一台从服务器 | 2N |
| 一台主服务器+两台从服务器 | 3N |
| 一台主服务器+三台从服务器 | 4N |
| ...... | ...... |

### 从服务器的创建与使用

使用SLAVEOF命令或者slaveof选项 .

#### 创建从服务器的方法

Redis提供了两种方法来为某个主服务器创建从服务器 :

* **使用**`SLAVEOF <master-ip><master-port>`**命令 . **比如向一个服务器发送SLAVEOF 127.0.0.1 6379 , 可以让接收到该命令的服务器变为127.0.0.1:6379的从服务器 . 在将一个服务器设置成从服务器之后 , 可以通过向它发送SLAVEOF no one来让它变回一个主服务器\(数据库已有的数据会被保留\) . 
* 在启动服务器时 , 通过**设置**`slaveof <master-ip><master-port>`**配置选项**来让服务器成为指定服务器的从服务器 . 

**举例说明**

如果客户端对服务器`127.0.0.1:6380`发送命令`SLAVEOF 127.0.0.1 6379` , 那么`127.0.0.1:6380`将成为`127.0.0.1:6379`的从服务器 .

![](/assets/fuzhi34.png)

**命令操作**

```
127.0.0.1:6379> SET msg "hello world"
OK
127.0.0.1:6379> INCR counter 
(integer) 1
127.0.0.1:6379> INCR counter 
(integer) 2
127.0.0.1:6379> RPUSH lst 1 3 5 7 9 
(integer) 5
127.0.0.1:6380> GET msg "hello world"
127.0.0.1:6380> GET counter 
"2"
127.0.0.1:6380> LRANGE lst 0 -1 
1) "1"
2) "3"
3) "5"
4) "7” 
5) "9"
```

### 处理服务器下线



