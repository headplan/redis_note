# HyperLogLog

使用常量空间计算大量元素的基数.

**应用场景:记录网站每天获得的独立IP数量**

**使用集合实现**

使用集合来存储每个访客的IP,通过集合中每个元素都各不相同的特性,来得到多个独立IP,然后通过调用SCARD命令来得出独立IP的数量.

```
ip = get_vistor_ip()
SADD '2016.7.30::unique::ip' ip
```

然后使用SCARD就可以获取当前的唯一IP数量:

SCARD 'keyname'

使用集合实现独立IP记录会带来一个问题,字符串记录一个IPv4最多需要消耗15个字节,IPv6会更多一些,这样持续下去,下号的内存会越来越多,下面是一个内存消耗表:

![](/assets/Snip20160728_1.png)

为了更好的解决类似独立IP计算这种问题,Redis在2.8.9版本添加了HyperLogLog结构.

### HyperLogLog介绍

HLL可以介绍多个元素作为输入,并给出输入元素的基数估算值

* 基数:就是集合中不同元素的数量,例如集合中有5个元素,2个相同,另外3个相同,则基数为2
* 估算值:算法给出的基数并非精确的,但误差也会在合理的范围内.

HLL类型的优点是,即使输入的元素数量或者体积非常大,计算基数所需要的空间也总是固定,并且很小的.
在Redis中,每个HLL键只需要12KB内存,就可以计算2^64个不同元素的基数.但是,HLL只会根据输入元素来计算基数,而不会存储输入元素的本身,意思就是不会像集合一样,返回输入的各个元素.

添加元素





返回基数估算值





合并多个HyperLogLog







